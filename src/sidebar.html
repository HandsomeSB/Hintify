<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      padding: 0;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      color: var(--vscode-foreground);
      font-family: var(--vscode-font-family);
      background-color: var(--vscode-sideBar-background);
    }

    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column-reverse;
    }

    #content {
      position: relative;
      background-color: var(--vscode-editor-background);
      border: 1px solid var(--vscode-widget-border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 8px;
      font-size: 13px;
      line-height: 1.6;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .bottom-bar {
      background-color: var(--vscode-editor-background);
      border-top: 1px solid var(--vscode-widget-border);
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #007acc;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 16px;
    }

    select {
      background-color: var(--vscode-dropdown-background);
      color: var(--vscode-dropdown-foreground);
      border: 1px solid var(--vscode-dropdown-border);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 13px;
      outline: none;
    }

    select:focus {
      border-color: var(--vscode-focusBorder);
    }

    code {
      font-family: var(--vscode-editor-font-family);
      background-color: var(--vscode-textCodeBlock-background);
      padding: 2px 4px;
      border-radius: 3px;
    }

    pre {
      background-color: var(--vscode-textCodeBlock-background);
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div id="content"></div>
  </div>
  <div class="bottom-bar">
    <div class="avatar">H</div>
    <select id="personSelect">
      <option value="assistant">AI Assistant</option>
      <option value="user">User</option>
      <option value="system">System</option>
    </select>
    <button id="recordToggle" onclick="toggleRecord()">Click Me</button>
  </div>
  <script>
    const vscode = acquireVsCodeApi();
    function toggleRecord() {
      vscode.postMessage({
        command: 'recordToggle'
      });
    }

    window.addEventListener('message', (event) => {
      const message = event.data;
      switch (message.command) {
        case 'recordToggle':
          // Display the return value
          document.getElementById('recordToggle').textContent = message.result;
          break;
        case 'updateContent':
          const text = message.data;
          const contentElement = document.getElementById('content');
          contentElement.innerHTML = '';
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = text;
          const textNodes = [];
          let currentTexts = [];

          function getAllTextNodes(node) {
            if (node.nodeType === 3) { // Text node
              if (node.nodeValue.trim() !== '') {
                textNodes.push(node);
                currentTexts.push(node.nodeValue);
              }
            } else {
              for (let child of node.childNodes) {
                getAllTextNodes(child);
              }
            }
          }

          getAllTextNodes(tempDiv);
          contentElement.appendChild(tempDiv);
          
          // Clear all text nodes
          textNodes.forEach((node, index) => {
            node.nodeValue = '';
          });

          let nodeIndex = 0;
          let charIndex = 0;

          function typeWriter() {
            if (nodeIndex < textNodes.length) {
              if (charIndex < currentTexts[nodeIndex].length) {
                textNodes[nodeIndex].nodeValue += currentTexts[nodeIndex][charIndex];
                charIndex++;
                setTimeout(typeWriter, 50);
              } else {
                nodeIndex++;
                charIndex = 0;
                setTimeout(typeWriter, 50);
              }
            }
          }

          typeWriter();
          break;
      }
    });

  </script>
</body>
</html>