<!DOCTYPE html>
<html>
<head>
  <style>
    button { padding: 10px; background-color: #007acc; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #005f99; }
  </style>
</head>
<body>
  <h1>Sidebar Works!</h1>
  <button id="recordToggle" onclick="toggleRecord()">Click Me</button>
  <div id="content"></div>
  <script>
    const vscode = acquireVsCodeApi();
    function toggleRecord() {
      vscode.postMessage({
        command: 'recordToggle'
      });
    }

    window.addEventListener('message', (event) => {
      const message = event.data;
      switch (message.command) {
        case 'recordToggle':
          // Display the return value
          document.getElementById('recordToggle').textContent = message.result;
          break;
        case 'updateContent':
          const text = message.data;
          const contentElement = document.getElementById('content');
          contentElement.innerHTML = '';
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = text;
          const textNodes = [];
          let currentTexts = [];

          function getAllTextNodes(node) {
            if (node.nodeType === 3) { // Text node
              if (node.nodeValue.trim() !== '') {
                textNodes.push(node);
                currentTexts.push(node.nodeValue);
              }
            } else {
              for (let child of node.childNodes) {
                getAllTextNodes(child);
              }
            }
          }

          getAllTextNodes(tempDiv);
          contentElement.appendChild(tempDiv);
          
          // Clear all text nodes
          textNodes.forEach((node, index) => {
            node.nodeValue = '';
          });

          let nodeIndex = 0;
          let charIndex = 0;

          function typeWriter() {
            if (nodeIndex < textNodes.length) {
              if (charIndex < currentTexts[nodeIndex].length) {
                textNodes[nodeIndex].nodeValue += currentTexts[nodeIndex][charIndex];
                charIndex++;
                setTimeout(typeWriter, 50);
              } else {
                nodeIndex++;
                charIndex = 0;
                setTimeout(typeWriter, 50);
              }
            }
          }

          typeWriter();
          break;
      }
    });

  </script>
</body>
</html>